<?xml version="1.0" encoding="UTF-8"?>

<f:view xmlns="http://www.w3.org/1999/xhtml"
        xmlns:h="http://java.sun.com/jsf/html" xmlns:ui="http://java.sun.com/jsf/facelets"
        xmlns:p="http://primefaces.org/ui" xmlns:f="http://java.sun.com/jsf/core"
        xmlns:icon="http://se.vgregion.ifeed.icon"
>

  <h:messages/>

  <h:panelGroup id="resultGroup">
    <div>
      <table class="mdl-data-table mdl-js-data-table mdl-data-table--selectable mdl-data-table-customization">
        <thead>
        <tr>
          <th class="filter-result-h mdl-data-table__cell--non-numeric">Namn</th>
          <th class="filter-result-h mdl-data-table__cell--non-numeric">Ägare / Admin</th>
          <th class="filter-result-h mdl-data-table__cell--non-numeric">Beskrivning</th>
          <th class="filter-result-h mdl-data-table__cell--non-numeric">Förvaltning</th>
          <th class="filter-result-h mdl-data-table__cell--non-numeric">Grupp</th>
          <th class="filter-result-h mdl-data-table__cell--non-numeric">Id</th>
          <th class="filter-result-d mdl-data-table__cell--non-numeric">Ta bort</th>
        </tr>
        <tr>
          <th class="filter-result-h mdl-data-table__cell--non-numeric">
            <p:inputText placeholder="Filtrera på namn"
                         value="${filter.name}"
                         listener="#{app.updateFilterQuery}"
                         id="filterOnName"
                         styleClass="filterOnName mdl-textfield__input"
                         onkeypress="if (event.keyCode == 13) {event.preventDefault(); this.onchange(); }">
              <f:ajax event="change" render="ifeed_view" listener="#{app.updateFilterQuery}"/>
              <p:watermark for="filterOnName" value="Sök namn"/>
            </p:inputText>
          </th>
          <th class="filter-result-h mdl-data-table__cell--non-numeric">
            <p:inputText value="${filter.userId}" style="width:50px;" id="filterOnUserId"
                         styleClass="mdl-textfield__input"
                         onkeypress="if (event.keyCode == 13) {event.preventDefault(); this.onchange(); }">
              <f:ajax event="change" render="ifeed_view" listener="#{app.updateFilterQuery}"/>
              <p:watermark for="filterOnUserId" value="Vgr-Id"/>
            </p:inputText>
          </th>
          <th class="filter-result-h mdl-data-table__cell--non-numeric">
            <p:inputText value="${filter.description}" id="filterOnDescription"
                         styleClass="mdl-textfield__input"
                         onkeypress="if (event.keyCode == 13) {event.preventDefault(); this.onchange(); }">
              <f:ajax event="change" render="ifeed_view" listener="#{app.updateFilterQuery}"/>
              <p:watermark for="filterOnDescription" value="Sök beskrivning"/>
            </p:inputText>
          </th>
          <th class="filter-result-h mdl-data-table__cell--non-numeric">
            <div class="mdl-selectfield mdl-js-selectfield">
              <h:selectOneMenu style="text-align:left;"
                               converter="departmentConverter"
                               update=":ifeed_view"
                               ajax="true"
                               id="filterOnDepartment"
                               value="#{filter.department}">
                <f:selectItem itemLabel="-" itemValue="#{null}"/>
                <f:selectItems value="#{app.getVgrDepartments()}"
                               var="i" itemLabel="#{i.name}" itemValue="#{i}"/>
                <f:ajax event="change" render="ifeed_view" listener="#{app.updateFilterQuery}"/>
              </h:selectOneMenu>
            </div>
          </th>
          <th class="filter-result-h mdl-data-table__cell--non-numeric">
            <div class="mdl-selectfield mdl-js-selectfield">
            <h:selectOneMenu style="text-align:left;"
                             converter="groupConverter"
                             id="filterOnGroup"
                             update=":ifeed_view"
                             ajax="true"
                             rendered="#{filter.department != null}"
                             value="#{filter.group}">
              <f:selectItem itemLabel="-" itemValue="#{null}"/>
              <f:selectItems value="#{filter.department.vgrGroups}"
                             var="i" itemLabel="#{i.name}" itemValue="#{i}"/>
              <f:ajax event="change" render="ifeed_view" listener="#{app.updateFilterQuery}"/>
            </h:selectOneMenu>
            </div>
          </th>
          <th class="filter-result-h mdl-data-table__cell--non-numeric">
            <p:inputText value="${filter.idAsText}" size="8" style="width: 50px;" id="filterOnIdAsText"
                         styleClass="mdl-textfield__input"
                         onkeypress="if (event.keyCode == 13) {event.preventDefault(); this.onchange(); }">
              <f:ajax event="change" render="ifeed_view" listener="#{app.updateFilterQuery}"/>
              <p:watermark for="filterOnIdAsText" value="Sök Id"/>
            </p:inputText>
          </th>
          <th class="filter-result-d">
          </th>
        </tr>
        </thead>
        <tbody>
        <ui:repeat value="#{app.page()}" var="item" id="hitlist" varStatus="status">
          <tr class="ui-widget-content #{status.even ? 'ui-datatable-even' : 'ui-datatable-odd'}">
            <td class="mdl-data-table__cell--non-numeric">
              <p:commandLink update=":ifeed_view" ajax="false" async="true"
                             value="#{item.name}"
                             actionListener="#{app.viewIFeed(item.id)}"/>
            </td>
            <td class="mdl-data-table__cell--non-numeric">
              ${item.userId}
              #{filter.toTextUserIds(item.ownerships)}
            </td>
            <td class="mdl-data-table__cell--non-numeric">${item.description}</td>
            <td class="mdl-data-table__cell--non-numeric">${item.department != null ? item.department.name : '-'}</td>
            <td class="mdl-data-table__cell--non-numeric">${item.group != null ? item.group.name : '-'}</td>
            <td class="mdl-data-table__cell--non-numeric">${item.id}</td>
            <td class="mdl-data-table__cell--non-numeric">
              <p:commandLink
                  action="#{app.removeFeed(item)}"
                  styleClass="link-button-trash"
                  update=":ifeed_view"
                  ajax="false"
                  rendered="#{item != null and app.mayEditFeed(request, item)}"
                  async="true">
                <icon:delete/>
              </p:commandLink>
            </td>
          </tr>
        </ui:repeat>
        </tbody>
      </table>
      Sida #{app.currentPage + 1} av #{app.getMaxPageCount()}
      <p:commandLink update=":ifeed_view" ajax="false" async="true"
                     value="Föregående sida"
                     rendered="#{app.currentPage > 0}"
                     styleClass="padding-right: 0.5em;"
                     actionListener="#{app.previousPage()}"/>

      <h:outputText value=" | "
                    rendered="#{app.currentPage > 0 and app.getMaxPageCount() > (app.currentPage + 1)}"/>

      <p:commandLink update=":ifeed_view" ajax="false" async="true"
                     value="Nästa sida"
                     rendered="#{app.getMaxPageCount() > (app.currentPage + 1)}"
                     actionListener="#{app.nextPage()}"/>
    </div>
  </h:panelGroup>
</f:view>